@{
    ViewBag.Title = "Home Page";
}
<p class="text-success">@ViewBag.StatusMessage</p>
<h2>Главная страница</h2>

@ViewBag.Result

<h3>Выберите файл для загрузки</h3>
@using (Html.BeginForm("Upload", "File", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <input type="file" name="uploads" multiple>
    <br>
    if (User.Identity.IsAuthenticated)
    {
        <div>
            <div>
                Доступ к файлу
            </div>
            <div id="access">
                @*@Html.Label("Access", "Открытый")*@
                Закрытый
                @Html.RadioButton("access", "private", true) &nbsp;
                Открытый
                @Html.RadioButton("access", "public")
            </div>
            <br />
            <div>
                Срок хранения файла
            </div>
            3 дня
            @Html.RadioButton("retentionPeriodId", 1, true) &nbsp;
            7 дней
            @Html.RadioButton("retentionPeriodId", 2) &nbsp;
            1 месяц
            @Html.RadioButton("retentionPeriodId", 3) &nbsp;
        </div>
        <br />
    }
    else
    {
        <div id="access" style="display: none">
            <div>
                Доступ к файлу
            </div>
            <div>
                @*@Html.Label("Access", "Открытый")*@
                Закрытый
                @Html.RadioButton("access", "private", true) &nbsp;
                Открытый
                @Html.RadioButton("access", "public")
            </div>
            <div>
                Срок хранения файла
            </div>
            10 секунд
            @Html.RadioButton("retentionPeriodId", 1, true) &nbsp;
            30 секунд
            @Html.RadioButton("retentionPeriodId", 2) &nbsp;
            1 минуту
            @Html.RadioButton("retentionPeriodId", 3) &nbsp;
        </div>

    }
    <input type="submit" value="Загрузить" />
}
@{
    string link;
}
@if (ViewBag.File != null)
{
    @ViewBag.File.Name
    <br />
    @Html.ActionLink("Сгенерировать ссылку для скачивания", "GetFileDownloadLink", "File", new { fileId = ViewBag.File.Id }, null)
    <br />
    if (ViewBag.File.FileUniqueKeyId != null)
    {
        foreach (var uniqueKey in ViewBag.FileUniqueKeys)
        {
            if (ViewBag.File.FileUniqueKeyId == uniqueKey.Id)
            {
                link = Url.Content("https://localhost:44301/File/DownloadByLink?fileId=" + ViewBag.File.Id + '&' + "uniqueKey=" + uniqueKey.UniqueKey);
                @*@Html.ActionLink("Скачать через ссылку", "DownloadByLink", "File", new { fileId = item.Id, uniqueKey = uniqueKey.UniqueKey }, null)*@
                <a id="linkFile" onclick="copyToClipboard()">@link</a>
                <br />
                <div>Нажмите на ссылку, чтобы скопировать ее</div>
            }
        }
    }
}

@section scripts {
    <script type="text/javascript">
        @*var access = document.getElementById("access");
        access.hidden = true;
        if (@User.Identity.IsAuthenticated) {
            //access.style.display = "block";
            access.hidden = false;
        }*@

        function copyToClipboard() {
            var copytext = document.createElement('input')
            copytext.value = document.getElementById("linkFile").innerHTML.toString();
            document.body.appendChild(copytext)
            copytext.select()
            document.execCommand('copy')
            document.body.removeChild(copytext)
        }

        document.addEventListener('copy', function (e) {

            // Нам необходимо предотвратить стандартное копирование,
            // иначе все просто скопируется как обычно.
            e.preventDefault();

            // Событие не дает нам доступ к буферу поэтому
            // нам надо добавить выделение с помощью Selection API.
            var selection = window.getSelection().toString();

            // Трансформируем выделенное как хотим
            var linkText = selection.replace("&amp;", "&");

            // Вставляем измененный текст в буфер.
            e.clipboardData.setData('text/plain', linkText);

        })
    </script>
}