@*@model IEnumerable<FileSharing.Models.User>*@
@model FileSharing.Models.PageViewModel
@using FileSharing.Helpers
@{
    ViewBag.Title = "Index";
}

<h2>Панель администратора</h2>

<div class="panel panel-default">
    <div class="panel-heading">
        @Html.ActionLink("Список пользователей", "Index", "Admin", htmlAttributes: new { @class = "btn btn-default btn-primary selected" })
        @Html.ActionLink("Список файлов", "FileList", "Admin", htmlAttributes: new { @class = "btn btn-default" })
    </div>
    <div class="panel-body">
        <table class="table table-striped table-condensed table-bordered" id="users">
            <tr>
                <th class="text-right">
                    @*@Html.DisplayNameFor(model => model.Id)*@
                    Id
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Email)*@
                    Электронная почта
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Login)*@
                    Логин
                </th>
                @*<th>
                        @Html.DisplayNameFor(model => model.Password)
                    </th>*@
                <th>
                    @*@Html.DisplayNameFor(model => model.Age)*@
                    Возраст
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Gender)*@
                    Пол
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.RoleId)*@
                    Роль
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.RoleId)*@
                    Файлы
                </th>
                <th class="text-center">
                    Действия
                </th>
            </tr>

            @foreach (var item in Model.Users)
            {
                <tr>
                    <td class="text-right">
                        @Html.DisplayFor(modelItem => item.Id)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Email)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.Login)*@
                        @Html.ActionLink(item.Login, "AccountDetails", new { userId = item.Id })
                    </td>
                    @*<td>
                            @Html.DisplayFor(modelItem => item.Password)
                        </td>*@
                    <td>
                        @Html.DisplayFor(modelItem => item.Age)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Gender)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.RoleId)
                    </td>
                    <td>
                        @{
                            Queue<string> fileNames = new Queue<string>();
                            foreach (var file in ViewBag.Files)
                            {
                                if (file.UserId == item.Id)
                                {
                                    fileNames.Enqueue(file.Name);
                                }
                            }
                        }
                        @foreach (var file in ViewBag.Files)
                        {
                            if (file.UserId == item.Id)
                            {
                                @Html.ActionLink(fileNames.Dequeue(), "Details", "File", new { id = file.Id }, null)
                                <br />
                            }
                        }
                    </td>
                    <td class="text-center">
                        @*@Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                            @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                            @Html.ActionLink("Delete", "Delete", new { id = item.Id })*@
                        @if (User.Identity.Name != item.Login)
                        {
                            using (Html.BeginForm("DeleteAccount", "Admin", new { userId = item.Id }))
                            {
                                @Html.Hidden("Id", item.Id)
                                <input type="submit" class="btn btn-default btn-xs" value="Удалить" />
                            }
                        }
                    </td>
                </tr>
            }

        </table>
    </div>
</div>
<br />
<div class="btn-group">
    @Html.PageLinks(Model.PageInfo, x => Url.Action("Index", new { page = x }))
</div>
@*@Html.Partial("_PageNav", ViewData["pvm"])*@

@using (Html.BeginForm("Index", "Admin", FormMethod.Get))
{
    @Html.AntiForgeryToken()

    <div class="form-inline">
        <h4>Фильтр</h4>
        <hr />

        @Html.Label("Фильтр", new { htmlAttributes = new { @class = "control-label" } })
        @Html.DropDownList("item", ViewData["Items"] as SelectList, htmlAttributes: new { @class = "form-control" })
        @*@Html.DisplayFor(model => model.Login)*@
        <input type="submit" value="Фильтр" class="btn btn-default" />
    </div>

}

@section scripts {
    <script type="text/javascript">

    </script>
}