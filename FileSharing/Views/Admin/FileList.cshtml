@*@model IEnumerable<FileSharing.Models.File>*@
@model FileSharing.Models.PageViewModel
@using FileSharing.Helpers
@{
    ViewBag.Title = "FileList";
}
<p class="text-success">@ViewBag.StatusMessage</p>
<h2>Панель администратора</h2>

<div class="panel panel-default">
    <div class="panel-heading">
        @Html.ActionLink("Список пользователей", "Index", "Admin", htmlAttributes: new { @class = "btn btn-default" })
        @Html.ActionLink("Список файлов", "FileList", "Admin", htmlAttributes: new { @class = "btn btn-default btn-primary selected" })
    </div>
    <div class="panel-body">
        <table class="table table-striped table-condensed table-bordered">
            <tr>
                <th class="text-right">
                    @*@Html.DisplayNameFor(model => model.Id)*@
                    Id
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Name)*@
                    Название
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.SizeInBytes)*@
                    Размер
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.User.Login)*@
                    Автор
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Date)*@
                    Дата загрузки
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Date)*@
                    Доступ к файлу
                </th>
                <th>
                    @*@Html.DisplayNameFor(model => model.Date)*@
                    Категория
                </th>
                <th class="text-center">
                    Действия
                </th>
            </tr>

            @foreach (var item in Model.Files)
            {
                <tr>
                    <td class="text-right">
                        @Html.DisplayFor(modelItem => item.Id)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.Name)*@
                        @Html.ActionLink(item.Name, "Details", "File", new { id = item.Id }, null)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.SizeInBytes)*@
                        @{
                            string size = string.Format("{0} Б", item.SizeInBytes);
                            double sizeInKBytes, sizeInMBytes, sizeInGBytes;
                            if (item.SizeInBytes >= 1024)
                            {
                                sizeInKBytes = (double)item.SizeInBytes / 1024;
                                size = string.Format("{0:N2} КБ", sizeInKBytes);
                                if (sizeInKBytes >= 1024)
                                {
                                    sizeInMBytes = (double)sizeInKBytes / 1024;
                                    size = string.Format("{0:N2} МБ", sizeInMBytes);
                                    if (sizeInMBytes >= 1024)
                                    {
                                        sizeInGBytes = (double)sizeInMBytes / 1024;
                                        size = string.Format("{0:N2} ГБ", sizeInGBytes);
                                    }
                                }
                            }
                        }
                        @size
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.User.Login)*@
                        @{
                            string login = "";
                            foreach (var user in ViewBag.Users)
                            {
                                if (user.Id == item.UserId)
                                {
                                    login = user.Login;
                                    @Html.ActionLink(login, "AccountDetails", new { userId = item.UserId })
                                }
                            }
                        }
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Date)
                    </td>
                    <td>
                        @(item.AccessId == 1 ? "private" : "public")
                    </td>
                                        <td>
                        @Html.DisplayFor(modelItem => item.CategoryId)
                    </td>
                    <td class="text-center">
                        @*@Html.ActionLink("Edit", "Edit", new { id = item.Id })
                            @Html.ActionLink("Details", "Details", new { id = item.Id }) |*@
                        @Html.ActionLink("Delete", "Delete", "File", new { fileId = item.Id }, null)
                        @*@using (Html.BeginForm("Delete", "File", new { fileId = item.Id }))
                            {
                                @Html.Hidden("Id", item.Id)
                                <input type="submit" class="btn btn-default btn-xs" value="Удалить файл" />
                            }*@
                    </td>
                </tr>
            }

        </table>
    </div>
</div>
<br />
<div class="btn-group">
    @Html.PageLinks(Model.PageInfo, x => Url.Action("FileList", new { page = x }))
</div>